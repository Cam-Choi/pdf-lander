<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PDF Viewer</title>
    <style>
      :root { --bg: #0e0e0f; --fg: #e8e8ea; }
      html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); }
      .viewer, iframe { position: fixed; inset: 0; width: 100%; height: 100%; border: 0; background: var(--bg); }
      body { overscroll-behavior: none; }

      /* Mobile scroll renderer */
      #mobile-root { position: fixed; inset: 0; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 12px 0 48px; display: none; }
      #pages { display: flex; flex-direction: column; align-items: center; gap: 12px; }
      canvas { max-width: 100%; height: auto; box-shadow: 0 2px 24px rgba(0,0,0,.4); border-radius: 6px; background: #111; }
      #loading { position: fixed; top: 12px; left: 50%; transform: translateX(-50%); font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; opacity: .8; }
      #fallback { display:none; position: absolute; inset: 0; place-items: center; }
      a { color: #9cf; }
    </style>
  </head>
  <body>
    <!-- Desktop: native inline PDF -->
    <iframe id="desktop-frame" class="viewer" src="https://Cam-Choi.github.io/pdf-lander/document.pdf" title="PDF"></iframe>

    <!-- Mobile: scroll-only renderer -->
    <div id="mobile-root" aria-live="polite">
      <div id="loading">Loading PDF…</div>
      <div id="pages"></div>
      <div id="fallback">
        <p>Unable to display the PDF. <a href="https://Cam-Choi.github.io/pdf-lander/document.pdf">Open the file</a>.</p>
      </div>
    </div>

    <script>
      const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      const PDF_URL = "https://Cam-Choi.github.io/pdf-lander/document.pdf";

      if (!isMobile) {
        // Desktop uses built-in viewer
        document.getElementById('desktop-frame').style.display = 'block';
      } else {
        // Mobile: use PDF.js (CDN) and render pages into canvases
        document.getElementById('desktop-frame').style.display = 'none';
        document.getElementById('mobile-root').style.display = 'block';

        const script = document.createElement('script');
        // Stable classic build (includes window.pdfjsLib)
        script.src = "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js";
        script.onload = startMobileRenderer;
        script.onerror = () => document.getElementById('fallback').style.display = 'grid';
        document.head.appendChild(script);
      }

      function startMobileRenderer() {
        const pdfjsLib = window.pdfjsLib;
        if (!pdfjsLib) { document.getElementById('fallback').style.display = 'grid'; return; }

        // Avoid needing a worker file; run in main thread (fine for typical PDFs)
        const getDocOpts = { url: PDF_URL, disableWorker: true };

        const pagesContainer = document.getElementById('pages');
        const loading = document.getElementById('loading');

        pdfjsLib.getDocument(getDocOpts).promise.then(async (pdf) => {
          const total = pdf.numPages;
          if (!total) throw new Error('Empty PDF');
          loading.textContent = `Rendering 1/${total}…`;

          for (let p = 1; p <= total; p++) {
            const page = await pdf.getPage(p);

            // Fit to screen width with small padding
            const unscaled = page.getViewport({ scale: 1 });
            const targetWidth = Math.min(document.documentElement.clientWidth, window.innerWidth) - 16;
            const scale = Math.max(0.1, targetWidth / unscaled.width);
            const viewport = page.getViewport({ scale });

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d', { alpha: false });
            canvas.width = Math.floor(viewport.width);
            canvas.height = Math.floor(viewport.height);

            pagesContainer.appendChild(canvas);
            loading.textContent = `Rendering ${p}/${total}…`;

            await page.render({ canvasContext: context, viewport }).promise;
          }

          loading.remove();
        }).catch((err) => {
          console.error(err);
          loading.remove();
          document.getElementById('fallback').style.display = 'grid';
        });
      }
    </script>
  </body>
</html>
