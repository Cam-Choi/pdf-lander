<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Document</title>
    <style>
      :root { --bg: #0e0e0f; --fg: #e8e8ea; }
      html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); }
      .viewer, iframe { position: fixed; inset: 0; width: 100%; height: 100%; border: 0; background: var(--bg); }
      body { overscroll-behavior: none; }

      /* Mobile renderer */
      #mobile-root { position: fixed; inset: 0; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 12px 0 48px; display: none; }
      #pages { display: flex; flex-direction: column; align-items: center; gap: 12px; }
      canvas { max-width: 100%; height: auto; box-shadow: 0 2px 24px rgba(0,0,0,.4); border-radius: 6px; background: #111; }
      #loading { position: fixed; top: 12px; left: 50%; transform: translateX(-50%); font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; opacity: .8; }
      #fallback { display:none; position: absolute; inset: 0; place-items: center; }
      a { color: #9cf; }
    </style>
  </head>
  <body>
    <!-- Desktop/modern browsers: native inline PDF -->
    <iframe id="desktop-frame" class="viewer" src="document.pdf" title="PDF"></iframe>

    <!-- Mobile: clean, scroll-only renderer (no toolbar), fits width -->
    <div id="mobile-root" aria-live="polite">
      <div id="loading">Loading PDF…</div>
      <div id="pages"></div>
      <div id="fallback">
        <p>Unable to display the PDF. <a href="document.pdf">Open the file</a>.</p>
      </div>
    </div>

    <!-- Use local PDF.js build already in your repo: /pdfjs/build/* -->
    <script>
      const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      if (!isMobile) {
        // Desktop keeps native inline viewer
        document.getElementById('desktop-frame').style.display = 'block';
      } else {
        // Mobile: render with PDF.js for proper multi-page + fit-to-width scrolling
        document.getElementById('desktop-frame').style.display = 'none';
        document.getElementById('mobile-root').style.display = 'block';

        // Dynamically load PDF.js from local build
        const script = document.createElement('script');
        script.src = 'pdfjs/build/pdf.js';
        script.onload = startMobileRenderer;
        script.onerror = () => document.getElementById('fallback').style.display = 'grid';
        document.head.appendChild(script);
      }

      function startMobileRenderer() {
        if (!window['pdfjsLib']) { document.getElementById('fallback').style.display = 'grid'; return; }
        const pdfjsLib = window['pdfjsLib'];
        // Point the worker to the local file as well
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs/build/pdf.worker.js';

        const url = 'document.pdf'; // If your PDF has a different name, change here
        const pagesContainer = document.getElementById('pages');
        const loading = document.getElementById('loading');

        pdfjsLib.getDocument({ url }).promise.then(async (pdf) => {
          const total = pdf.numPages;
          if (!total) throw new Error('Empty PDF');
          loading.textContent = `Rendering 1/${total}…`;

          // Render pages sequentially to avoid thrashing on mobile
          for (let p = 1; p <= total; p++) {
            const page = await pdf.getPage(p);

            // Determine scale to fit page width to viewport (with small side padding)
            const unscaledViewport = page.getViewport({ scale: 1 });
            const targetWidth = Math.min(document.documentElement.clientWidth, window.innerWidth) - 16; // 8px padding each side
            const scale = Math.max(0.1, targetWidth / unscaledViewport.width);
            const viewport = page.getViewport({ scale });

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d', { alpha: false });
            canvas.width = Math.floor(viewport.width);
            canvas.height = Math.floor(viewport.height);

            pagesContainer.appendChild(canvas);
            loading.textContent = `Rendering ${p}/${total}…`;

            await page.render({ canvasContext: context, viewport }).promise;
          }

          loading.remove();
        }).catch((err) => {
          console.error(err);
          loading.remove();
          document.getElementById('fallback').style.display = 'grid';
        });
      }
    </script>

    <!-- If you still prefer the full PDF.js viewer on mobile, remove the custom renderer above
         and instead use this link (ensure the path to your PDF is correct from /pdfjs/web/):
         /pdfjs/web/viewer.html?file=../../document.pdf#zoom=page-width
         Note the ../../ (from /pdfjs/web/ to repo root). Using ../document.pdf would be WRONG. -->

    <noscript>
      <!-- No JS? Fall back to the full viewer with a correct relative path -->
      <meta http-equiv="refresh" content="0; url=pdfjs/web/viewer.html?file=../../document.pdf#zoom=page-width" />
    </noscript>
  </body>
</html>
