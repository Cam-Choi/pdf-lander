<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PDF Viewer</title>
    <style>
      :root { --bg: #0e0e0f; --fg: #e8e8ea; }
      html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); }
      .viewer, iframe { position: fixed; inset: 0; width: 100%; height: 100%; border: 0; background: var(--bg); }
      body { overscroll-behavior: none; }

      /* Mobile renderer */
      #mobile-root { position: fixed; inset: 0; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 12px 0 48px; display: none; }
      #pages { display: flex; flex-direction: column; align-items: center; gap: 12px; }
      canvas { max-width: 100%; height: auto; box-shadow: 0 2px 24px rgba(0,0,0,.4); border-radius: 6px; background: #111; }
      #loading { position: fixed; top: 12px; left: 50%; transform: translateX(-50%); font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; opacity: .8; }
      #fallback { display:none; position: absolute; inset: 0; place-items: center; }
      a { color: #9cf; }
    </style>
  </head>
  <body>
    <!-- Desktop: native inline PDF -->
    <iframe id="desktop-frame" class="viewer" src="https://Cam-Choi.github.io/pdf-lander/document.pdf" title="PDF"></iframe>

    <!-- Mobile: scroll-only renderer -->
    <div id="mobile-root" aria-live="polite">
      <div id="loading">Loading PDF…</div>
      <div id="pages"></div>
      <div id="fallback">
        <p>Unable to display the PDF. <a href="https://Cam-Choi.github.io/pdf-lander/document.pdf">Open the file</a>.</p>
      </div>
    </div>

    <!-- Load PDF.js from your repo's build folder -->
    <script>
      const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      if (!isMobile) {
        document.getElementById('desktop-frame').style.display = 'block';
      } else {
        document.getElementById('desktop-frame').style.display = 'none';
        document.getElementById('mobile-root').style.display = 'block';

        const script = document.createElement('script');
        script.src = 'pdfjs/build/pdf.js';
        script.onload = startMobileRenderer;
        script.onerror = () => document.getElementById('fallback').style.display = 'grid';
        document.head.appendChild(script);
      }

      function startMobileRenderer() {
        if (!window['pdfjsLib']) { document.getElementById('fallback').style.display = 'grid'; return; }
        const pdfjsLib = window['pdfjsLib'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs/build/pdf.worker.js';

        const url = 'https://Cam-Choi.github.io/pdf-lander/document.pdf';
        const pagesContainer = document.getElementById('pages');
        const loading = document.getElementById('loading');

        pdfjsLib.getDocument({ url }).promise.then(async (pdf) => {
          const total = pdf.numPages;
          if (!total) throw new Error('Empty PDF');
          loading.textContent = `Rendering 1/${total}…`;

          for (let p = 1; p <= total; p++) {
            const page = await pdf.getPage(p);

            const unscaledViewport = page.getViewport({ scale: 1 });
            const targetWidth = Math.min(document.documentElement.clientWidth, window.innerWidth) - 16;
            const scale = Math.max(0.1, targetWidth / unscaledViewport.width);
            const viewport = page.getViewport({ scale });

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d', { alpha: false });
            canvas.width = Math.floor(viewport.width);
            canvas.height = Math.floor(viewport.height);

            pagesContainer.appendChild(canvas);
            loading.textContent = `Rendering ${p}/${total}…`;

            await page.render({ canvasContext: context, viewport }).promise;
          }

          loading.remove();
        }).catch((err) => {
          console.error(err);
          loading.remove();
          document.getElementById('fallback').style.display = 'grid';
        });
      }
    </script>
  </body>
</html>
